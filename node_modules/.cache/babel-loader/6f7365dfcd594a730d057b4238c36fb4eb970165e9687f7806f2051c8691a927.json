{"ast":null,"code":"import axios from 'axios';\nimport { YoutubeTranscript } from 'youtube-transcript';\nexport const extractVideoId = url => {\n  try {\n    // Handle different YouTube URL formats\n    const patterns = [/(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/|youtube\\.com\\/embed\\/|youtube\\.com\\/v\\/|youtube\\.com\\/watch\\?.*&v=)([^#&?]*).*/, /youtube\\.com\\/shorts\\/([^#&?]*).*/, /youtube\\.com\\/watch\\?.*v=([^#&?]*).*/];\n    for (const pattern of patterns) {\n      const match = url.match(pattern);\n      if (match && match[1] && match[1].length === 11) {\n        return match[1];\n      }\n    }\n\n    // If no pattern matches, try to extract from the URL directly\n    const urlObj = new URL(url);\n    const searchParams = new URLSearchParams(urlObj.search);\n    const videoId = searchParams.get('v');\n    if (videoId && videoId.length === 11) {\n      return videoId;\n    }\n    return null;\n  } catch (error) {\n    console.error('Error extracting video ID:', error);\n    return null;\n  }\n};\nexport const getVideoTranscript = async videoId => {\n  try {\n    var _videoResponse$data$i;\n    const API_KEY = process.env.REACT_APP_YOUTUBE_API_KEY;\n    if (!API_KEY) {\n      throw new Error('YouTube API key is not configured. Please add REACT_APP_YOUTUBE_API_KEY to your environment variables.');\n    }\n\n    // First, get video details to check if video exists\n    const videoResponse = await axios.get(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${API_KEY}`);\n    if (!((_videoResponse$data$i = videoResponse.data.items) !== null && _videoResponse$data$i !== void 0 && _videoResponse$data$i.length)) {\n      throw new Error('Video not found. Please check the URL and try again.');\n    }\n    try {\n      // Configure YoutubeTranscript\n      const transcriptConfig = {\n        lang: 'en',\n        // Try English first\n        country: 'US'\n      };\n\n      // Get transcript using youtube-transcript package\n      const transcriptItems = await YoutubeTranscript.fetchTranscript(videoId, transcriptConfig);\n      if (!transcriptItems || transcriptItems.length === 0) {\n        // Try without language specification if English fails\n        const fallbackTranscript = await YoutubeTranscript.fetchTranscript(videoId);\n        if (!fallbackTranscript || fallbackTranscript.length === 0) {\n          throw new Error('No transcript available for this video. Please try a video with captions.');\n        }\n        return fallbackTranscript.map(item => item.text).join(' ');\n      }\n\n      // Combine all transcript segments into one string\n      const transcript = transcriptItems.map(item => item.text).join(' ');\n      return transcript;\n    } catch (transcriptError) {\n      var _transcriptError$mess, _transcriptError$mess2;\n      console.error('Transcript fetch error:', transcriptError);\n\n      // Provide more specific error messages based on the error\n      if ((_transcriptError$mess = transcriptError.message) !== null && _transcriptError$mess !== void 0 && _transcriptError$mess.includes('Could not get the transcript')) {\n        throw new Error('This video does not have captions available. Please try a different video.');\n      }\n      if ((_transcriptError$mess2 = transcriptError.message) !== null && _transcriptError$mess2 !== void 0 && _transcriptError$mess2.includes('Could not find a transcript')) {\n        throw new Error('No captions found for this video. Please try a video with captions enabled.');\n      }\n      throw new Error('Could not fetch transcript. Please make sure the video has captions available.');\n    }\n  } catch (error) {\n    var _error$response, _error$response2;\n    console.error('Error:', error);\n    if ((error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 403) {\n      throw new Error('API key is invalid or quota exceeded. Please check your YouTube API configuration.');\n    }\n    if ((error === null || error === void 0 ? void 0 : (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.status) === 404) {\n      throw new Error('Video not found. Please check the URL and try again.');\n    }\n    throw error; // Re-throw the original error to preserve the specific error message\n  }\n};","map":{"version":3,"names":["axios","YoutubeTranscript","extractVideoId","url","patterns","pattern","match","length","urlObj","URL","searchParams","URLSearchParams","search","videoId","get","error","console","getVideoTranscript","_videoResponse$data$i","API_KEY","process","env","REACT_APP_YOUTUBE_API_KEY","Error","videoResponse","data","items","transcriptConfig","lang","country","transcriptItems","fetchTranscript","fallbackTranscript","map","item","text","join","transcript","transcriptError","_transcriptError$mess","_transcriptError$mess2","message","includes","_error$response","_error$response2","response","status"],"sources":["D:/rvce/src/services/youtubeService.ts"],"sourcesContent":["import axios from 'axios';\r\nimport { YoutubeTranscript } from 'youtube-transcript';\r\n\r\ninterface VideoResponse {\r\n  items: Array<{\r\n    id: string;\r\n    snippet: {\r\n      title: string;\r\n      description: string;\r\n    };\r\n  }>;\r\n}\r\n\r\nexport const extractVideoId = (url: string): string | null => {\r\n  try {\r\n    // Handle different YouTube URL formats\r\n    const patterns = [\r\n      /(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/|youtube\\.com\\/embed\\/|youtube\\.com\\/v\\/|youtube\\.com\\/watch\\?.*&v=)([^#&?]*).*/,\r\n      /youtube\\.com\\/shorts\\/([^#&?]*).*/,\r\n      /youtube\\.com\\/watch\\?.*v=([^#&?]*).*/\r\n    ];\r\n\r\n    for (const pattern of patterns) {\r\n      const match = url.match(pattern);\r\n      if (match && match[1] && match[1].length === 11) {\r\n        return match[1];\r\n      }\r\n    }\r\n\r\n    // If no pattern matches, try to extract from the URL directly\r\n    const urlObj = new URL(url);\r\n    const searchParams = new URLSearchParams(urlObj.search);\r\n    const videoId = searchParams.get('v');\r\n    \r\n    if (videoId && videoId.length === 11) {\r\n      return videoId;\r\n    }\r\n\r\n    return null;\r\n  } catch (error) {\r\n    console.error('Error extracting video ID:', error);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const getVideoTranscript = async (videoId: string): Promise<string> => {\r\n  try {\r\n    const API_KEY = process.env.REACT_APP_YOUTUBE_API_KEY;\r\n    \r\n    if (!API_KEY) {\r\n      throw new Error('YouTube API key is not configured. Please add REACT_APP_YOUTUBE_API_KEY to your environment variables.');\r\n    }\r\n\r\n    // First, get video details to check if video exists\r\n    const videoResponse = await axios.get<VideoResponse>(\r\n      `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${API_KEY}`\r\n    );\r\n\r\n    if (!videoResponse.data.items?.length) {\r\n      throw new Error('Video not found. Please check the URL and try again.');\r\n    }\r\n\r\n    try {\r\n      // Configure YoutubeTranscript\r\n      const transcriptConfig = {\r\n        lang: 'en', // Try English first\r\n        country: 'US'\r\n      };\r\n\r\n      // Get transcript using youtube-transcript package\r\n      const transcriptItems = await YoutubeTranscript.fetchTranscript(videoId, transcriptConfig);\r\n      \r\n      if (!transcriptItems || transcriptItems.length === 0) {\r\n        // Try without language specification if English fails\r\n        const fallbackTranscript = await YoutubeTranscript.fetchTranscript(videoId);\r\n        if (!fallbackTranscript || fallbackTranscript.length === 0) {\r\n          throw new Error('No transcript available for this video. Please try a video with captions.');\r\n        }\r\n        return fallbackTranscript.map(item => item.text).join(' ');\r\n      }\r\n\r\n      // Combine all transcript segments into one string\r\n      const transcript = transcriptItems\r\n        .map(item => item.text)\r\n        .join(' ');\r\n\r\n      return transcript;\r\n    } catch (transcriptError: any) {\r\n      console.error('Transcript fetch error:', transcriptError);\r\n      \r\n      // Provide more specific error messages based on the error\r\n      if (transcriptError.message?.includes('Could not get the transcript')) {\r\n        throw new Error('This video does not have captions available. Please try a different video.');\r\n      }\r\n      if (transcriptError.message?.includes('Could not find a transcript')) {\r\n        throw new Error('No captions found for this video. Please try a video with captions enabled.');\r\n      }\r\n      \r\n      throw new Error('Could not fetch transcript. Please make sure the video has captions available.');\r\n    }\r\n  } catch (error: any) {\r\n    console.error('Error:', error);\r\n    if (error?.response?.status === 403) {\r\n      throw new Error('API key is invalid or quota exceeded. Please check your YouTube API configuration.');\r\n    }\r\n    if (error?.response?.status === 404) {\r\n      throw new Error('Video not found. Please check the URL and try again.');\r\n    }\r\n    throw error; // Re-throw the original error to preserve the specific error message\r\n  }\r\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}